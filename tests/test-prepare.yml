---
- name: Prepare remote file system.
  hosts: blocks
  gather_facts: False
  tasks:
    - name: Ensures '~/sources' directory exists
      file: path='~/sources' state=directory
      when: inventory_hostname != 'localhost'
    - name: Copy event handler source files.
      template: src='{{ item }}' dest='~/sources/' force=Yes
      with_fileglob:
        - sources/*.js
      when: inventory_hostname != 'localhost'
- name: Test PubNub Blocks module for Ansible.
  hosts: blocks
  gather_facts: False
  tasks:
    - name: Delete '{{ lookup("env","BLOCK_NAME") }}'
      pubnub_blocks:
        email: '{{ lookup("env","PUBNUB_USER") }}'
        password: '{{ lookup("env","PUBNUB_PASS") }}'
        application: '{{ lookup("env","PUBNUB_APP_NAME") }}'
        keyset: '{{ lookup("env","PUBNUB_APP_KEYSET_NAME") }}'
        name: '{{ lookup("env","BLOCK_NAME") }}'
        state: absent